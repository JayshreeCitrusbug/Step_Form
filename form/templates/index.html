<!DOCTYPE html>
{% load static %}
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript" src="{% static 'js\script.js' %}"></script>
<link rel="stylesheet" href="{% static 'css\style.css' %}">
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

<body>

    <form id="regForm" action="/action_page.php">
        <h1>Register</h1>
        <!-- One "tab" for each step in the form: -->
        <div class="tab">Personal Info:
            <p><input placeholder="First name..." oninput="this.className = ''" name="fname"></p>
            <p><input placeholder="Last name..." oninput="this.className = ''" name="lname"></p>
            <p><input placeholder="E-mail..." oninput="this.className = ''" name="email1"></p>
            <p><input placeholder="Password..." oninput="this.className = ''" name="pword" type="password"></p>
            <p><input placeholder="Confirm Password..." oninput="this.className = ''" name="cpword" type="password"></p>
        </div>
        <div class="tab">Basic Info:
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" oninput="this.className = ''" id="inlineRadio1" value="option1">
                <label class="form-check-label" for="inlineRadio1">Male</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" oninput="this.className = ''" id="inlineRadio2" value="option2">
                <label class="form-check-label" for="inlineRadio2">Female</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" oninput="this.className = ''" id="inlineRadio3" value="option2">
                <label class="form-check-label" for="inlineRadio3">Other</label>
              </div>
            <p><input type="date" placeholder="dd-mm-yyyy" name="bd" id="bdate" onchange="calculateage()" oninput="this.className = ''" max="2022-07-31"></p>
            <!-- <fieldset disabled> -->
                <div class="form-group">
                  <label for="age">Age</label>
                  <input type="text" id="age" class="form-control" onmouseleave="setage()" oninput="this.className = ''" placeholder="Age" value="">
                </div>
            <!-- </fieldset> -->
        </div>
        <div class="tab">Contact Info:
            <p><input type="text" placeholder="Address..." oninput="this.className = ''" name="add"></p>
            <!-- <div class="form-group">
                <label for="exampleFormControlTextarea1">Example textarea</label>
                <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
              </div> -->
            
            <label>Country:<select class="form-select" name="country" id="country">
                  <option value="" selected="selected">Select country</option>
                  {% for c in country %}
                  <option value="{{c.id}}">{{c.name}}</option>
                  {% endfor %}
                </select>
              </label>
            
            <br>
              <label>
                State:
                <select class="form-select" name="state" id="state">
                  <option value="" selected="selected">Please select country first</option>
              </label>
              </select>
            
              

        </div>
        <div class="tab">Hobbies Info:
            <p><input placeholder="Username..." oninput="this.className = ''" name="uname"></p>
            <select class="form-check-input">
                <option selected>Known Language</option>
                <option value="1">English</option>
                <option value="2">Hindi</option>
                <option value="3">Gujarati</option>
                <option value="4">Marathi</option>
                <option value="5">Tamil</option>
                <option value="6">Bangali</option>
              </select>
            <!-- <p><input placeholder="Password..." oninput="this.className = ''" name="pword" type="password"></p> -->
        </div>
        <div style="overflow:auto;">
            <div style="float:right;">
                <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
                <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
            </div>
        </div>
        <!-- Circles which indicates the steps of the form: -->
        <div style="text-align:center;margin-top:40px;">
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
        </div>
    </form>
    <script>
        var currentTab = 0; // Current tab is set to be the first tab (0)
showTab(currentTab); // Display the current tab

function showTab(n) {
    // This function will display the specified tab of the form...
    var x = document.getElementsByClassName("tab");
    x[n].style.display = "block";
    //... and fix the Previous/Next buttons:
    if (n == 0) {
        document.getElementById("prevBtn").style.display = "none";
    } else {
        document.getElementById("prevBtn").style.display = "inline";
    }
    if (n == (x.length - 1)) {
        document.getElementById("nextBtn").innerHTML = "Submit";
    } else {
        document.getElementById("nextBtn").innerHTML = "Next";
    }
    //... and run a function that will display the correct step indicator:
    fixStepIndicator(n)
}

function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");
    // Exit the function if any field in the current tab is invalid:
    if (n == 1 && !validateForm()) return false;
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form...
    if (currentTab >= x.length) {
        // ... the form gets submitted:
        document.getElementById("regForm").submit();
        return false;
    }
    // Otherwise, display the correct tab:
    showTab(currentTab);
}

function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].getElementsByTagName("input");
    // A loop that checks every input field in the current tab:
    for (i = 0; i < y.length; i++) {
        // If a field is empty...
        if (y[i].value == "") {
            // add an "invalid" class to the field:
            y[i].className += " invalid";
            // and set the current valid status to false
            valid = false;
        }
    }
    // If the valid status is true, mark the step as finished and valid:
    if (valid) {
        document.getElementsByClassName("step")[currentTab].className += " finish";
    }
    return valid; // return the valid status
}

function fixStepIndicator(n) {
    // This function removes the "active" class of all steps...
    var i, x = document.getElementsByClassName("step");
    for (i = 0; i < x.length; i++) {
        x[i].className = x[i].className.replace(" active", "");
    }
    //... and adds the "active" class on the current step:
    x[n].className += " active";
}

function calculateage(){
    var today = new Date();
    console.log("today",today)
    var date = document.getElementById("bdate");
    // console.log("date",date.value);
    var birthDate = new Date(date.value);
    console.log('birthDate',birthDate)
    var age = today.getFullYear() - birthDate.getFullYear();
    var m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    console.log("age",age)
    return age;
}


function setage(){
    console.log("setage")
    document.getElementById("age").setAttribute("value", calculateage())
}
var stateSel = $("#state")

$('#country').on("change", function () {

stateSel.empty()

stateSel.append($("<option></option>")
  .attr("value", "")
  .text("----------------------"));

// Ajax call for select states by country id........................................
var selectedCountry = $('#country').val()
console.log("Selected Country Id:", selectedCountry)
var request = $.ajax({
  url: 'http://127.0.0.1:8000/form/state',
  type: 'GET',
  data: { 'CountryId': selectedCountry },
  success: function (data) {
    if(data.length==0){
      stateSel.append($("<option></option>")
      .attr("value", "0")
      .text("No States are available"));
    }
    for (var i = 0; i < data.length; i++) {
      // console.log(data.length)
      // console.log(data[i].name)
      stateSel.append($("<option></option>")
        .attr("value", data[i].id)
        .text(data[i].name));

    }
    
  }
});
});
console.log("Selected State Id:",  $('#state').val())
    </script>

</body>

</html>